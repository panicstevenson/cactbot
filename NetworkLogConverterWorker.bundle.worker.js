(()=>{"use strict";const t=["timestamp","source","id","ability","target","capture"],e=["timestamp","source","sourceId","id","ability","targetId","target","capture"],a=["timestamp","sourceId","source","id","ability","targetId","target","flags","flag0","flag1","flag2","flag3","flag4","flag5","flag6","flag7","flag8","flag9","flag10","flag11","flag12","flag13","flag14","targetHp","targetMaxHp","targetMp","targetMaxMp","targetX","targetY","targetZ","targetHeading","hp","maxHp","mp","maxMp","x","y","z","heading","capture"],i=["timestamp","targetId","target","id","capture"],s=["timestamp","name","capture"],n=["timestamp","id","name","job","level","hp","x","y","z","npcId","capture"],r=["timestamp","id","name","hp","x","y","z","capture"],o=["timestamp","targetId","target","effect","source","duration","capture"],l=["timestamp","targetId","target","job","hp","maxHp","mp","maxMp","x","y","z","heading","data0","data1","data2","data3","data4","capture"],d=["timestamp","targetId","target","effect","source","capture"],p=["timestamp","job","strength","dexterity","vitality","intelligence","mind","piety","attackPower","directHit","criticalHit","attackMagicPotency","healMagicPotency","determination","skillSpeed","spellSpeed","tenacity","capture"],u=["timestamp","source","sourceId","target","targetId","id","capture"],m=["timestamp","target","source","capture"],c=["timestamp","name","hp","capture"],h=["timestamp","code","line","capture"],g=["timestamp","code","line","name","capture"],v=["timestamp","code","line","capture"],f=["timestamp","code","line","capture"],y=["timestamp","code","name","line","capture"],b=["timestamp","name","capture"],C=["timestamp","instance","command","data0","data1","data2","data3","capture"];class x{static startsUsing(e){void 0===e&&(e={}),x.validateParams(e,"startsUsing",t);const a=x.trueIfUndefined(e.capture);let i=x.maybeCapture(a,"timestamp","\\y{Timestamp}")+" 14:"+x.maybeCapture(a,"id",e.id,"\\y{AbilityCode}")+":";return(e.source||e.id||e.target||a)&&(i+=x.maybeCapture(a,"source",e.source,".*?")+" starts using "),(e.ability||e.target||a)&&(i+=x.maybeCapture(a,"ability",e.ability,".*?")+" on "),(e.target||a)&&(i+=x.maybeCapture(a,"target",e.target,".*?")+"\\."),x.parse(i)}static ability(t){void 0===t&&(t={}),x.validateParams(t,"ability",e);const a=x.trueIfUndefined(t.capture);let i=x.maybeCapture(a,"timestamp","\\y{Timestamp}")+" 1[56]:"+x.maybeCapture(a,"sourceId","\\y{ObjectId}")+":"+x.maybeCapture(a,"source",t.source,"[^:]*?")+":";return(t.id||t.ability||t.target||t.targetId||a)&&(i+=x.maybeCapture(a,"id",t.id,"\\y{AbilityCode}")+":"),(t.ability||t.target||t.targetId||a)&&(i+=x.maybeCapture(a,"ability",t.ability,"[^:]*?")+":"),(t.target||t.targetId||a)&&(i+=x.maybeCapture(a,"targetId","\\y{ObjectId}")+":"),(t.target||a)&&(i+=x.maybeCapture(a,"target",t.target,"[^:]*?")+":"),x.parse(i)}static abilityFull(t){void 0===t&&(t={}),x.validateParams(t,"abilityFull",a);const e=x.trueIfUndefined(t.capture),i=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 1[56]:"+x.maybeCapture(e,"sourceId",t.sourceId,"\\y{ObjectId}")+":"+x.maybeCapture(e,"source",t.source,"[^:]*?")+":"+x.maybeCapture(e,"id",t.id,"\\y{AbilityCode}")+":"+x.maybeCapture(e,"ability",t.ability,"[^:]*?")+":"+x.maybeCapture(e,"targetId",t.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(e,"target",t.target,"[^:]*?")+":"+x.maybeCapture(e,"flags",t.flags,"[^:]*?")+":"+x.maybeCapture(e,"flag0",t.flag0,"[^:]*?")+":"+x.maybeCapture(e,"flag1",t.flag1,"[^:]*?")+":"+x.maybeCapture(e,"flag2",t.flag2,"[^:]*?")+":"+x.maybeCapture(e,"flag3",t.flag3,"[^:]*?")+":"+x.maybeCapture(e,"flag4",t.flag4,"[^:]*?")+":"+x.maybeCapture(e,"flag5",t.flag5,"[^:]*?")+":"+x.maybeCapture(e,"flag6",t.flag6,"[^:]*?")+":"+x.maybeCapture(e,"flag7",t.flag7,"[^:]*?")+":"+x.maybeCapture(e,"flag8",t.flag8,"[^:]*?")+":"+x.maybeCapture(e,"flag9",t.flag9,"[^:]*?")+":"+x.maybeCapture(e,"flag10",t.flag10,"[^:]*?")+":"+x.maybeCapture(e,"flag11",t.flag11,"[^:]*?")+":"+x.maybeCapture(e,"flag12",t.flag12,"[^:]*?")+":"+x.maybeCapture(e,"flag13",t.flag13,"[^:]*?")+":"+x.maybeCapture(e,"flag14",t.flag13,"[^:]*?")+":"+x.optional(x.maybeCapture(e,"targetHp",t.targetHp,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"targetMaxHp",t.targetMaxHp,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"targetMp",t.targetMp,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"targetMaxMp",t.targetMaxMp,"\\y{Float}"))+":"+x.optional("\\y{Float}")+":"+x.optional("\\y{Float}")+":"+x.optional(x.maybeCapture(e,"targetX",t.targetX,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"targetY",t.targetY,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"targetZ",t.targetZ,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"targetHeading",t.targetHeading,"\\y{Float}"))+":"+x.maybeCapture(e,"hp",t.hp,"\\y{Float}")+":"+x.maybeCapture(e,"maxHp",t.maxHp,"\\y{Float}")+":"+x.maybeCapture(e,"mp",t.mp,"\\y{Float}")+":"+x.maybeCapture(e,"maxMp",t.maxMp,"\\y{Float}")+":\\y{Float}:\\y{Float}:"+x.maybeCapture(e,"x",t.x,"\\y{Float}")+":"+x.maybeCapture(e,"y",t.y,"\\y{Float}")+":"+x.maybeCapture(e,"z",t.z,"\\y{Float}")+":"+x.maybeCapture(e,"heading",t.heading,"\\y{Float}")+":.*?$";return x.parse(i)}static headMarker(t){void 0===t&&(t={}),x.validateParams(t,"headMarker",i);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 1B:"+x.maybeCapture(e,"targetId",t.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(e,"target",t.target,"[^:]*?")+":....:....:"+x.maybeCapture(e,"id",t.id,"....")+":";return x.parse(a)}static addedCombatant(t){void 0===t&&(t={}),x.validateParams(t,"addedCombatant",s);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 03:\\y{ObjectId}:Added new combatant "+x.maybeCapture(e,"name",t.name,".*?")+"\\.";return x.parse(a)}static addedCombatantFull(t){void 0===t&&(t={}),x.validateParams(t,"addedCombatantFull",n);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 03:"+x.maybeCapture(e,"id",t.id,"\\y{ObjectId}")+":Added new combatant "+x.maybeCapture(e,"name",t.name,"[^:]*?")+"\\. {2}Job: "+x.maybeCapture(e,"job",t.job,"[^:]*?")+" Level: "+x.maybeCapture(e,"level",t.level,"[^:]*?")+" Max HP: "+x.maybeCapture(e,"hp",t.hp,"[0-9]+")+"..*?Pos: \\("+x.maybeCapture(e,"x",t.x,"\\y{Float}")+","+x.maybeCapture(e,"y",t.y,"\\y{Float}")+","+x.maybeCapture(e,"z",t.z,"\\y{Float}")+"\\)(?: \\("+x.maybeCapture(e,"npcId",t.npcId,".*?")+"\\))?\\.";return x.parse(a)}static removingCombatant(t){void 0===t&&(t={}),x.validateParams(t,"removingCombatant",r);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 04:"+x.maybeCapture(e,"id","\\y{ObjectId}")+":Removing combatant "+x.maybeCapture(e,"name",t.name,".*?")+"\\..*?Max HP: "+x.maybeCapture(e,"hp",t.hp,"[0-9]+")+"."+x.optional(".*?Pos: \\("+x.maybeCapture(e,"x",t.x,"\\y{Float}")+","+x.maybeCapture(e,"y",t.y,"\\y{Float}")+","+x.maybeCapture(e,"z",t.z,"\\y{Float}")+"\\)");return x.parse(a)}static gainsEffect(t){void 0===t&&(t={}),x.validateParams(t,"gainsEffect",o);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 1A:"+x.maybeCapture(e,"targetId",t.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(e,"target",t.target,".*?")+" gains the effect of "+x.maybeCapture(e,"effect",t.effect,".*?")+" from "+x.maybeCapture(e,"source",t.source,".*?")+" for "+x.maybeCapture(e,"duration",t.duration,"\\y{Float}")+" Seconds\\.";return x.parse(a)}static statusEffectExplicit(t){void 0===t&&(t={}),x.validateParams(t,"statusEffectExplicit",l);const e=x.trueIfUndefined(t.capture),a=".*?:",i=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 26:"+x.maybeCapture(e,"targetId",t.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(e,"target",t.target,"[^:]*?")+":[0-9A-F]{0,6}"+x.maybeCapture(e,"job",t.job,"[0-9A-F]{0,2}")+":"+x.maybeCapture(e,"hp",t.hp,"\\y{Float}")+":"+x.maybeCapture(e,"maxHp",t.maxHp,"\\y{Float}")+":"+x.maybeCapture(e,"mp",t.mp,"\\y{Float}")+":"+x.maybeCapture(e,"maxMp",t.maxMp,"\\y{Float}")+":"+a+a+x.optional(x.maybeCapture(e,"x",t.x,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"y",t.y,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"z",t.z,"\\y{Float}"))+":"+x.optional(x.maybeCapture(e,"heading",t.heading,"\\y{Float}"))+":"+x.maybeCapture(e,"data0",t.data0,"[^:]*?")+":"+x.maybeCapture(e,"data1",t.data1,"[^:]*?")+":"+x.optional(x.maybeCapture(e,"data2",t.data2,"[^:]*?")+":")+x.optional(x.maybeCapture(e,"data3",t.data3,"[^:]*?")+":")+x.optional(x.maybeCapture(e,"data4",t.data4,"[^:]*?")+":");return x.parse(i)}static losesEffect(t){void 0===t&&(t={}),x.validateParams(t,"losesEffect",d);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 1E:"+x.maybeCapture(e,"targetId",t.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(e,"target",t.target,".*?")+" loses the effect of "+x.maybeCapture(e,"effect",t.effect,".*?")+" from "+x.maybeCapture(e,"source",t.source,".*?")+"\\.";return x.parse(a)}static tether(t){void 0===t&&(t={}),x.validateParams(t,"tether",u);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 23:"+x.maybeCapture(e,"sourceId",t.sourceId,"\\y{ObjectId}")+":"+x.maybeCapture(e,"source",t.source,"[^:]*?")+":"+x.maybeCapture(e,"targetId",t.targetId,"\\y{ObjectId}")+":"+x.maybeCapture(e,"target",t.target,"[^:]*?")+":....:....:"+x.maybeCapture(e,"id",t.id,"....")+":";return x.parse(a)}static wasDefeated(t){void 0===t&&(t={}),x.validateParams(t,"wasDefeated",m);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 19:"+x.maybeCapture(e,"target",t.target,".*?")+" was defeated by "+x.maybeCapture(e,"source",t.source,".*?")+"\\.";return x.parse(a)}static hasHP(t){void 0===t&&(t={}),x.validateParams(t,"hasHP",c);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 0D:"+x.maybeCapture(e,"name",t.name,".*?")+" HP at "+x.maybeCapture(e,"hp",t.hp,"\\d+")+"%";return x.parse(a)}static echo(t){return void 0===t&&(t={}),x.validateParams(t,"echo",h),x.gameLog({line:t.line,capture:t.capture,code:"0038"})}static dialog(t){void 0===t&&(t={}),x.validateParams(t,"dialog",g);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 00:"+x.maybeCapture(e,"code","0044")+":"+x.maybeCapture(e,"name",t.name,".*?")+":"+x.maybeCapture(e,"line",t.line,".*")+"$";return x.parse(a)}static message(t){return void 0===t&&(t={}),x.validateParams(t,"message",v),x.gameLog({line:t.line,capture:t.capture,code:"0839"})}static gameLog(t){void 0===t&&(t={}),x.validateParams(t,"gameLog",f);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 00:"+x.maybeCapture(e,"code",t.code,"....")+":"+x.maybeCapture(e,"line",t.line,".*")+"$";return x.parse(a)}static gameNameLog(t){void 0===t&&(t={}),x.validateParams(t,"gameNameLog",y);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 00:"+x.maybeCapture(e,"code",t.code,"....")+":"+x.maybeCapture(e,"name",t.name,"[^:]*")+":"+x.maybeCapture(e,"line",t.line,".*")+"$";return x.parse(a)}static statChange(t){void 0===t&&(t={}),x.validateParams(t,"statChange",p);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 0C:Player Stats: "+x.maybeCapture(e,"job",t.job,"\\d+")+":"+x.maybeCapture(e,"strength",t.strength,"\\d+")+":"+x.maybeCapture(e,"dexterity",t.dexterity,"\\d+")+":"+x.maybeCapture(e,"vitality",t.vitality,"\\d+")+":"+x.maybeCapture(e,"intelligence",t.intelligence,"\\d+")+":"+x.maybeCapture(e,"mind",t.mind,"\\d+")+":"+x.maybeCapture(e,"piety",t.piety,"\\d+")+":"+x.maybeCapture(e,"attackPower",t.attackPower,"\\d+")+":"+x.maybeCapture(e,"directHit",t.directHit,"\\d+")+":"+x.maybeCapture(e,"criticalHit",t.criticalHit,"\\d+")+":"+x.maybeCapture(e,"attackMagicPotency",t.attackMagicPotency,"\\d+")+":"+x.maybeCapture(e,"healMagicPotency",t.healMagicPotency,"\\d+")+":"+x.maybeCapture(e,"determination",t.determination,"\\d+")+":"+x.maybeCapture(e,"skillSpeed",t.skillSpeed,"\\d+")+":"+x.maybeCapture(e,"spellSpeed",t.spellSpeed,"\\d+")+":0:"+x.maybeCapture(e,"tenacity",t.tenacity,"\\d+");return x.parse(a)}static changeZone(t){void 0===t&&(t={}),x.validateParams(t,"changeZone",b);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 01:Changed Zone to "+x.maybeCapture(e,"name",t.name,".*?")+"\\.";return x.parse(a)}static network6d(t){void 0===t&&(t={}),x.validateParams(t,"network6d",C);const e=x.trueIfUndefined(t.capture),a=x.maybeCapture(e,"timestamp","\\y{Timestamp}")+" 21:"+x.maybeCapture(e,"instance",t.instance,".*?")+":"+x.maybeCapture(e,"command",t.command,".*?")+":"+x.maybeCapture(e,"data0",t.data0,".*?")+":"+x.maybeCapture(e,"data1",t.data1,".*?")+":"+x.maybeCapture(e,"data2",t.data2,".*?")+":"+x.maybeCapture(e,"data3",t.data3,".*?")+"$";return x.parse(a)}static maybeCapture(t,e,a,i){return a||(a=i),a=x.anyOf(a),t?x.namedCapture(e,a):a}static optional(t){return`(?:${t})?`}static namedCapture(t,e){return t.includes(">")&&console.error('"'+t+'" contains ">".'),t.includes("<")&&console.error('"'+t+'" contains ">".'),"(?<"+t+">"+e+")"}static anyOf(...t){let e=[];return e=1===t.length?Array.isArray(t[0])?t[0]:t[0]?[t[0]]:[]:t,(t=>`(?:${t.map((t=>t instanceof RegExp?t.source:t)).join("|")})`)(e)}static parse(t){const e={Timestamp:"^.{14}",NetTimestamp:".{33}",NetField:"(?:[^|]*\\|)",LogType:"[0-9A-Fa-f]{2}",AbilityCode:"[0-9A-Fa-f]{1,8}",ObjectId:"[0-9A-F]{8}",Name:"(?:[^\\s:|]+(?: [^\\s:|]+)?|)",Float:"-?[0-9]+(?:[.,][0-9]+)?(?:E-?[0-9]+)?"};let a="i";return t instanceof RegExp&&(a+=(t.global?"g":"")+(t.multiline?"m":""),t=t.source),t=t.replace(/\\y\{(.*?)\}/g,((t,a)=>e[a]||t)),new RegExp(t,a)}static parseGlobal(t){const e=x.parse(t);let a="gi";return t instanceof RegExp&&(a+=t.multiline?"m":""),new RegExp(e.source,a)}static trueIfUndefined(t){return void 0===t||!!t}static validateParams(t,e,a){if(null===t)return;if("object"!=typeof t)return;const i=Object.keys(t);for(let t=0;t<i.length;++t){const s=i[t];if(s&&!a.includes(s))throw new Error(`${e}: invalid parameter '${s}'.  Valid params: ${JSON.stringify(a)}`)}}}const I=/^\^\^/,S=["ability","name","source","target","line"],N=(t,e,a)=>{var i,s,n,r,o,l;t=null!=t?t:{};const d=[];for(const t of Object.values(a))"object"==typeof t&&d.push(t.field);x.validateParams(t,e,["capture",...d]);const p=x.trueIfUndefined(t.capture),u=Object.keys(a);let m;if(p)m=u[u.length-1];else{m=0;for(const e of u){if("object"!=typeof(null!==(i=a[e])&&void 0!==i?i:{}))continue;const n=null===(s=a[e])||void 0===s?void 0:s.field;n&&n in t&&(m=e)}}const c=Object.keys(t).filter((t=>S.includes(t)));let h=w.flagTranslationsNeeded&&c.length>0?"^^":"^",g=-1;for(const i in a){const s=parseInt(i),d=s-g-1;1===d?h+="\\y{NetField}":d>1&&(h+=`\\y{NetField}{${d}}`),g=s;const u=a[s];if("object"!=typeof u)throw new Error(`${e}: invalid value: ${JSON.stringify(u)}`);const c=null===(n=a[s])||void 0===n?void 0:n.field,v=null!==(l=null===(o=null===(r=a[s])||void 0===r?void 0:r.value)||void 0===o?void 0:o.toString())&&void 0!==l?l:"[^|]*";if(h+=c?x.maybeCapture(p,c,t[c],v)+"\\|":v+"\\|",s>=(null!=m?m:0))break}return x.parse(h)};class w{static setFlagTranslationsNeeded(t){w.flagTranslationsNeeded=t}static doesNetRegexNeedTranslation(t){console.assert(w.flagTranslationsNeeded);const e="string"==typeof t?t:t.source;return!!I.exec(e)}static startsUsing(t){return N(t,"startsUsing",{0:{field:"type",value:"20"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"},8:{field:"castTime"}})}static ability(t){return N(t,"ability",{0:{field:"type",value:"2[12]"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"}})}static abilityFull(t){return N(t,"abilityFull",{0:{field:"type",value:"2[12]"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"id"},5:{field:"ability"},6:{field:"targetId"},7:{field:"target"},8:{field:"flags"},9:{field:"damage"},24:{field:"targetCurrentHp"},25:{field:"targetMaxHp"},40:{field:"x"},41:{field:"y"},42:{field:"z"},43:{field:"heading"}})}static headMarker(t){return N(t,"headMarker",{0:{field:"type",value:"27"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},6:{field:"id"}})}static addedCombatant(t){return N(t,"addedCombatant",{0:{field:"type",value:"03"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"}})}static addedCombatantFull(t){return N(t,"addedCombatantFull",{0:{field:"type",value:"03"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"},4:{field:"job"},5:{field:"level"},6:{field:"ownerId"},8:{field:"world"},9:{field:"npcNameId"},10:{field:"npcBaseId"},11:{field:"currentHp"},12:{field:"hp"},17:{field:"x"},18:{field:"y"},19:{field:"z"},20:{field:"heading"}})}static removingCombatant(t){return N(t,"removingCombatant",{0:{field:"type",value:"04"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"},12:{field:"hp"}})}static gainsEffect(t){return N(t,"gainsEffect",{0:{field:"type",value:"26"},1:{field:"timestamp"},2:{field:"effectId"},3:{field:"effect"},4:{field:"duration"},5:{field:"sourceId"},6:{field:"source"},7:{field:"targetId"},8:{field:"target"},9:{field:"count"}})}static statusEffectExplicit(t){return N(t,"statusEffectExplicit",{0:{field:"type",value:"38"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},5:{field:"hp"},6:{field:"maxHp"},11:{field:"x"},12:{field:"y"},13:{field:"z"},14:{field:"heading"},15:{field:"data0"},16:{field:"data1"},17:{field:"data2"},18:{field:"data3"},19:{field:"data4"}})}static losesEffect(t){return N(t,"losesEffect",{0:{field:"type",value:"30"},1:{field:"timestamp"},2:{field:"effectId"},3:{field:"effect"},5:{field:"sourceId"},6:{field:"source"},7:{field:"targetId"},8:{field:"target"},9:{field:"count"}})}static tether(t){return N(t,"tether",{0:{field:"type",value:"35"},1:{field:"timestamp"},2:{field:"sourceId"},3:{field:"source"},4:{field:"targetId"},5:{field:"target"},8:{field:"id"}})}static wasDefeated(t){return N(t,"wasDefeated",{0:{field:"type",value:"25"},1:{field:"timestamp"},2:{field:"targetId"},3:{field:"target"},4:{field:"sourceId"},5:{field:"source"}})}static echo(t){return void 0===t&&(t={}),x.validateParams(t,"echo",["type","timestamp","code","name","line","capture"]),t.code="0038",w.gameLog(t)}static dialog(t){return void 0===t&&(t={}),x.validateParams(t,"dialog",["type","timestamp","code","name","line","capture"]),t.code="0044",w.gameLog(t)}static message(t){return void 0===t&&(t={}),x.validateParams(t,"message",["type","timestamp","code","name","line","capture"]),t.code="0839",w.gameLog(t)}static gameLog(t){return N(t,"gameLog",{0:{field:"type",value:"00"},1:{field:"timestamp"},2:{field:"code"},3:{field:"name"},4:{field:"line"}})}static gameNameLog(t){return w.gameLog(t)}static statChange(t){return N(t,"statChange",{0:{field:"type",value:"12"},1:{field:"timestamp"},2:{field:"job"},3:{field:"strength"},4:{field:"dexterity"},5:{field:"vitality"},6:{field:"intelligence"},7:{field:"mind"},8:{field:"piety"},9:{field:"attackPower"},10:{field:"directHit"},11:{field:"criticalHit"},12:{field:"attackMagicPotency"},13:{field:"healMagicPotency"},14:{field:"determination"},15:{field:"skillSpeed"},16:{field:"spellSpeed"},18:{field:"tenacity"}})}static changeZone(t){return N(t,"changeZone",{0:{field:"type",value:"01"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"}})}static network6d(t){return N(t,"network6d",{0:{field:"type",value:"33"},1:{field:"timestamp"},2:{field:"instance"},3:{field:"command"},4:{field:"data0"},5:{field:"data1"},6:{field:"data2"},7:{field:"data3"}})}static nameToggle(t){return N(t,"nameToggle",{0:{field:"type",value:"34"},1:{field:"timestamp"},2:{field:"id"},3:{field:"name"},6:{field:"toggle"}})}}w.flagTranslationsNeeded=!1;const F={countdownStart:{en:"Battle commencing in (?<time>\\y{Float}) seconds! \\((?<player>.*?)\\)",de:"Noch (?<time>\\y{Float}) Sekunden bis Kampfbeginn! \\((?<player>.*?)\\)",fr:"Début du combat dans (?<time>\\y{Float}) secondes[ ]?! \\((?<player>.*?)\\)",ja:"戦闘開始まで(?<time>\\y{Float})秒！ \\((?<player>.*?)\\)",cn:"距离战斗开始还有(?<time>\\y{Float})秒！ （(?<player>.*?)）",ko:"전투 시작 (?<time>\\y{Float})초 전! \\((?<player>.*?)\\)"},countdownEngage:{en:"Engage!",de:"Start!",fr:"À l'attaque[ ]?!",ja:"戦闘開始！",cn:"战斗开始！",ko:"전투 시작!"},countdownCancel:{en:"Countdown canceled by (?<player>\\y{Name})",de:"(?<player>\\y{Name}) hat den Countdown abgebrochen",fr:"Le compte à rebours a été interrompu par (?<player>\\y{Name})[ ]?\\.",ja:"(?<player>\\y{Name})により、戦闘開始カウントがキャンセルされました。",cn:"(?<player>\\y{Name})取消了战斗开始倒计时。",ko:"(?<player>\\y{Name}) 님이 초읽기를 취소했습니다\\."},areaSeal:{en:"(?<area>.*?) will be sealed off in (?<time>\\y{Float}) seconds!",de:"Noch (?<time>\\y{Float}) Sekunden, bis sich (?<area>.*?) schließt",fr:"Fermeture (?<area>.*?) dans (?<time>\\y{Float}) secondes[ ]?\\.",ja:"(?<area>.*?)の封鎖まであと(?<time>\\y{Float})秒",cn:"距(?<area>.*?)被封锁还有(?<time>\\y{Float})秒",ko:"(?<time>\\y{Float})초 후에 (?<area>.*?)(이|가) 봉쇄됩니다\\."},areaUnseal:{en:"(?<area>.*?) is no longer sealed.",de:"(?<area>.*?) öffnet sich erneut.",fr:"Ouverture (?<area>.*?)[ ]?!",ja:"(?<area>.*?)の封鎖が解かれた……",cn:"(?<area>.*?)的封锁解除了",ko:"(?<area>.*?)의 봉쇄가 해제되었습니다\\."},craftingStart:{en:"You begin synthesizing (?<count>(an?|\\d+) )?(?<recipe>.*)\\.",de:"Du hast begonnen, durch Synthese (?<count>(ein(e|es|em|er)?|\\d+) )?(?<recipe>.*) herzustellen\\.",fr:"Vous commencez à fabriquer (?<count>(une?|\\d+) )?(?<recipe>.*)\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)(×(?<count>\\d+))?の製作を開始した。",cn:"(?<player>\\y{Name})开始制作“(?<recipe>.*)”(×(?<count>\\d+))?。",ko:"(?<recipe>.*)(×(?<count>\\d+)개)? 제작을 시작합니다\\."},trialCraftingStart:{en:"You begin trial synthesis of (?<recipe>.*)\\.",de:"Du hast mit der Testsynthese von (?<recipe>.*) begonnen\\.",fr:"Vous commencez une synthèse d'essai pour une? (?<recipe>.*)\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習を開始した。",cn:"(?<player>\\y{Name})开始练习制作(?<recipe>.*)。",ko:"(?<recipe>.*) 제작 연습을 시작합니다\\."},craftingFinish:{en:"You synthesize (?<count>(an?|\\d+) )?(?<recipe>.*)()?\\.",de:"Du hast erfolgreich (?<count>(ein(e|es|em|er)?|\\d+) )?(?<recipe>.*)()? hergestellt\\.",fr:"Vous fabriquez (?<count>(une?|\\d+) )?(?<recipe>.*)()?\\.",ja:"(?<player>\\y{Name})は(?<recipe>.*)()?(×(?<count>\\d+))?を完成させた！",cn:"(?<player>\\y{Name})制作“(?<recipe>.*)()?”(×(?<count>\\d+))?成功！",ko:"(?<player>\\y{Name}) 님이 (?<recipe>.*)()?(×(?<count>\\d+)개)?(을|를) 완성했습니다!"},trialCraftingFinish:{en:"Your trial synthesis of (?<recipe>.*) proved a success!",de:"Die Testsynthese von (?<recipe>.*) war erfolgreich!",fr:"Votre synthèse d'essai pour fabriquer (?<recipe>.*) a été couronnée de succès!",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習に成功した！",cn:"(?<player>\\y{Name})练习制作(?<recipe>.*)成功了！",ko:"(?<recipe>.*) 제작 연습에 성공했습니다!"},craftingFail:{en:"Your synthesis fails!",de:"Deine Synthese ist fehlgeschlagen!",fr:"La synthèse échoue\\.{3}",ja:"(?<player>\\y{Name})は製作に失敗した……",cn:"(?<player>\\y{Name})制作失败了……",ko:"제작에 실패했습니다……\\."},trialCraftingFail:{en:"Your trial synthesis of (?<recipe>.*) failed\\.{3}",de:"Die Testsynthese von (?<recipe>.*) ist fehlgeschlagen\\.{3}",fr:"Votre synthèse d'essai pour fabriquer (?<recipe>.*) s'est soldée par un échec\\.{3}",ja:"(?<player>\\y{Name})は(?<recipe>.*)の製作練習に失敗した……",cn:"(?<player>\\y{Name})练习制作(?<recipe>.*)失败了……",ko:"(?<recipe>.*) 제작 연습에 실패했습니다……\\."},craftingCancel:{en:"You cancel the synthesis\\.",de:"Du hast die Synthese abgebrochen\\.",fr:"La synthèse est annulée\\.",ja:"(?<player>\\y{Name})は製作を中止した。",cn:"(?<player>\\y{Name})中止了制作作业。",ko:"제작을 중지했습니다\\."},trialCraftingCancel:{en:"You abandoned trial synthesis\\.",de:"Testsynthese abgebrochen\\.",fr:"Vous avez interrompu la synthèse d'essai\\.",ja:"(?<player>\\y{Name})は製作練習を中止した。",cn:"(?<player>\\y{Name})停止了练习。",ko:"제작 연습을 중지했습니다\\."}};const M=new class{get localeRegex(){return this.regexes||(this.regexes=this.buildLocaleRegexes(F,(t=>x.gameLog({line:t+".*?"})))),this.regexes}get localeNetRegex(){return this.netRegexes||(this.netRegexes=this.buildLocaleRegexes(F,(t=>w.gameLog({line:t+"[^|]*?"})))),this.netRegexes}buildLocaleRegexes(t,e){return Object.fromEntries(Object.entries(t).map((([t,a])=>[t,this.buildLocaleRegex(a,e)])))}buildLocaleRegex(t,e){const a=e(t.en);return{en:a,de:t.de?e(t.de):a,fr:t.fr?e(t.fr):a,ja:t.ja?e(t.ja):a,cn:t.cn?e(t.cn):a,ko:t.ko?e(t.ko):a}}},E=(M.localeRegex,M.localeNetRegex);class L{static cloneData(t,e=["options","party"]){const a={};for(const i in t)e.includes(i)||("object"==typeof t[i]?a[i]=L._cloneData(t[i]):a[i]=t[i]);return a}static _cloneData(t){if("object"==typeof t){if(Array.isArray(t)){const e=[];for(let a=0;a<t.length;++a)e[a]=L._cloneData(t[a]);return e}if(null===t)return null;if(t instanceof RegExp)return new RegExp(t);const e={};for(const a in t)e[a]=L._cloneData(t[a]);return e}return t}static timeToString(t,e=!0){const a=t<0?"-":"",i=(t=Math.abs(t))%1e3,s=(t%6e4-i)/1e3,n=`00${i}`.substr(-3),r=`0${s}`.substr(-2);return a+("0"+((t%36e5-i)/1e3-s)/60).substr(-2)+":"+r+(e?"."+n:"")}static timeToDateString(t){return this.dateObjectToDateString(new Date(t))}static dateObjectToDateString(t){return`${t.getFullYear()}-${L.zeroPad((t.getMonth()+1).toString())}-${L.zeroPad(t.getDate().toString())}`}static timeToTimeString(t,e=!1){return this.dateObjectToTimeString(new Date(t),e)}static dateObjectToTimeString(t,e=!1){let a=`${L.zeroPad(t.getHours().toString())}:${L.zeroPad(t.getMinutes().toString())}:${L.zeroPad(t.getSeconds().toString())}`;return e&&(a+=`.${t.getMilliseconds()}`),a}static msToDuration(t){return L.timeToString(t,!1).replace(":","m")+"s"}static dateTimeToString(t,e=!1){const a=new Date(t);return`${this.dateObjectToDateString(a)} ${this.dateObjectToTimeString(a,e)}`}static zeroPad(t,e=2){return(""+t).padStart(e,"0")}static properCase(t){return t.replace(/([^\W_]+[^\s-]*) */g,(t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()))}static spacePadLeft(t,e){return t.padStart(e," ")}static doesLineMatch(t,e){if(e instanceof RegExp)return e.exec(t);for(const a in e){const i=a,s=e[i].exec(t);if(s)return s.groups&&(s.groups.language=i),s}return null}static matchStart(t){var e,a,i,s;let n;return n=L.doesLineMatch(t,L.countdownRegexes),n?(null!==(e=n.groups)&&void 0!==e||(n.groups={}),n.groups.StartIn=(1e3*parseInt(null!==(a=n.groups.time)&&void 0!==a?a:"0")).toString(),n.groups.StartType="Countdown",n):(n=L.doesLineMatch(t,L.sealRegexes),n?(null!==(i=n.groups)&&void 0!==i||(n.groups={}),n.groups.StartIn="0",n.groups.StartType="Seal",n):(n=L.doesLineMatch(t,L.engageRegexes),n?(null!==(s=n.groups)&&void 0!==s||(n.groups={}),n.groups.StartIn="0",n.groups.StartType="Engage",n):void 0))}static matchEnd(t){var e,a,i,s;let n;return n=L.doesLineMatch(t,L.winRegex),n?(null!==(e=n.groups)&&void 0!==e||(n.groups={}),n.groups.EndType="Win",n):(n=L.doesLineMatch(t,L.wipeRegex),n?(null!==(a=n.groups)&&void 0!==a||(n.groups={}),n.groups.EndType="Wipe",n):(n=L.doesLineMatch(t,L.cactbotWipeRegex),n?(null!==(i=n.groups)&&void 0!==i||(n.groups={}),n.groups.EndType="Cactbot Wipe",n):(n=L.doesLineMatch(t,L.unsealRegexes),n?(null!==(s=n.groups)&&void 0!==s||(n.groups={}),n.groups.EndType="Unseal",n):void 0)))}}L.sealRegexes=E.areaSeal,L.engageRegexes=E.countdownEngage,L.countdownRegexes=E.countdownStart,L.unsealRegexes=E.areaUnseal,L.wipeRegex=w.network6d({command:"40000010"}),L.winRegex=w.network6d({command:"40000003"}),L.cactbotWipeRegex=w.echo({line:"cactbot wipe.*?"});class T extends Error{constructor(){super("This code shouldn't be reached")}}class k{constructor(t,e){this.name="",this.server="",this.states={},this.significantStates=[],this.latestTimestamp=-1,this.id=t,this.setName(e)}setName(t){var e,a,i;if(""===t)return;const s=t.split("(");this.name=null!==(e=s[0])&&void 0!==e?e:"",s.length>1&&(this.server=null!==(i=null===(a=s[1])||void 0===a?void 0:a.replace(/\)$/,""))&&void 0!==i?i:"")}hasState(t){return void 0!==this.states[t]}pushState(t,e){this.states[t]=e,this.latestTimestamp=t,this.significantStates.includes(t)||this.significantStates.push(t)}nextSignificantState(t){var e;const a=this.significantStates.indexOf(t),i=this.significantStates.length-1;if(a>=0&&a<i)return this.getStateByIndex(a+1);if(a===i||t>(null!==(e=this.significantStates[i])&&void 0!==e?e:0))return this.getStateByIndex(i);for(let e=0;e<this.significantStates.length;++e){const a=this.significantStates[e];if(a&&a>t)return this.getStateByIndex(e)}return this.getStateByIndex(this.significantStates.length-1)}pushPartialState(t,e){var a;if(void 0===this.states[t]){const i=null!==(a=this.significantStates.filter((e=>e<t)).sort(((t,e)=>e-t))[0])&&void 0!==a?a:this.significantStates[0];if(void 0===i)throw new T;const s=this.states[i];if(!s)throw new T;this.states[t]=s.partialClone(e)}else{const a=this.states[t];if(!a)throw new T;this.states[t]=a.partialClone(e)}this.latestTimestamp=Math.max(this.latestTimestamp,t);const i=this.significantStates[this.significantStates.length-1];if(!i)throw new T;const s=JSON.stringify(this.states[i]),n=JSON.stringify(this.states[t]);i!==t&&n!==s&&this.significantStates.push(t)}getState(t){const e=this.states[t];if(e)return e;const a=this.significantStates[0];if(void 0===a)throw new T;if(t<a)return this.getStateByIndex(0);let i=0;for(;i<this.significantStates.length;++i){const e=this.significantStates[i];if(void 0===e)throw new T;if(e>t)return this.getStateByIndex(i-1)}return this.getStateByIndex(i-1)}getStateByIndex(t){const e=this.significantStates[t];if(void 0===e)throw new T;const a=this.states[e];if(void 0===a)throw new T;return a}}class j{static getJob(t){var e;for(const a in j.abilities)if(null===(e=j.abilities[a])||void 0===e?void 0:e.includes(t))return a}}j.abilityMatchRegex=/[a-fA-F0-9]{1,4}/i,j.abilities={PLD:[12959,12961,12964,12967,12968,12969,12970,12971,12972,12973,12974,12975,12976,12978,12980,12981,12982,12983,12984,12985,12986,12987,12988,12989,12991,12992,12993,12994,12996,13e3,13001,13006,14480,16457,16458,16459,16460,16461,17669,17671,17672,17691,17692,17693,17694,17866,18050,27,29,30,3538,3539,3540,3541,3542,4284,4285,4286,50207,50209,50246,50260,50261,50262,50263,50264,7382,7383,7384,7385,8746,8749,8750,8751,8752,8754,8755,8756],WAR:[16462,16463,16464,16465,17695,17696,17697,17698,17889,3549,3550,3551,3552,4289,4290,4291,49,50157,50218,50249,50265,50266,50267,50268,50269,51,52,7386,7387,7388,7389,8758,8761,8762,8763,8764,8765,8767,8768],DRK:[16466,16467,16468,16469,16470,16471,16472,17700,17701,17702,3617,3621,3623,3624,3625,3629,3632,3634,3636,3638,3639,3640,3641,3643,4303,4304,4305,4306,4307,4308,4309,4310,4311,4312,4680,50158,50159,50271,50272,50319,7390,7391,7392,7393,8769,8772,8773,8775,8776,8777,8778,8779],GNB:[17703,17704,17705,17706,17707,17708,17709,17710,17711,17712,17713,17714,17716,17717,17890,17891,16137,50320,16138,16139,16140,16141,16142,16143,16144,16145,16162,50257,16148,16149,16151,16152,50258,16153,16154,16146,16147,16150,16159,16160,16161,16155,16156,16157,16158,16163,16164,16165,50259],WHM:[12958,12962,12965,12997,13002,13003,13004,13005,131,136,137,139,140,14481,1584,16531,16532,16533,16534,16535,16536,17688,17689,17690,17789,17790,17791,17793,17794,17832,3568,3569,3570,3571,4296,4297,50181,50182,50196,50307,50308,50309,50310,7430,7431,7432,7433,8895,8896,8900,9621,127,133],SCH:[16537,16538,16539,16540,16541,16542,16543,16544,16545,16546,16547,16548,16550,16551,166,167,17215,17216,17795,17796,17797,17798,17802,17864,17865,17869,17870,17990,185,186,188,189,190,3583,3584,3585,3586,3587,4300,50184,50214,50311,50312,50313,50324,7434,7435,7436,7437,7438,7869,802,803,805,8904,8905,8909,9622],AST:[10027,10028,10029,16552,16553,16554,16555,16556,16557,16558,16559,17055,17151,17152,17804,17805,17806,17807,17809,17991,3590,3593,3594,3595,3596,3598,3599,3600,3601,3603,3604,3605,3606,3608,3610,3612,3613,3614,3615,4301,4302,4401,4402,4403,4404,4405,4406,4677,4678,4679,50122,50124,50125,50186,50187,50188,50189,50314,50315,50316,7439,7440,7441,7442,7443,7444,7445,7448,8324,8913,8914,8916,9629],MNK:[12960,12963,12966,12977,12979,12990,12995,12998,12999,14476,14478,16473,16474,16475,16476,17674,17675,17676,17677,17719,17720,17721,17722,17723,17724,17725,17726,3543,3545,3546,3547,4262,4287,4288,50160,50161,50245,50273,50274,63,70,71,7394,7395,7396,74,8780,8781,8782,8783,8784,8785,8787,8789,8925],DRG:[16477,16478,16479,16480,17728,17729,3553,3554,3555,3556,3557,4292,4293,50162,50163,50247,50275,50276,7397,7398,7399,7400,86,8791,8792,8793,8794,8795,8796,8797,8798,8799,8802,8803,8804,8805,8806,92,94,95,96,9640,75,78],NIN:[16488,16489,16491,16492,16493,17413,17414,17415,17416,17417,17418,17419,17420,17732,17733,17734,17735,17736,17737,17738,17739,2246,2259,2260,2261,2262,2263,2264,2265,2266,2267,2268,2269,2270,2271,2272,3563,3566,4295,50165,50166,50167,50250,50279,50280,7401,7402,7403,8807,8808,8809,8810,8812,8814,8815,8816,8820,9461],SAM:[16481,16482,16483,16484,16485,16486,16487,17740,17741,17742,17743,17744,50208,50215,50277,50278,7477,7478,7479,7480,7481,7482,7483,7484,7485,7486,7487,7488,7489,7490,7491,7492,7493,7494,7495,7496,7497,7498,7499,7501,7502,7855,7857,7867,8821,8822,8823,8824,8825,8826,8828,8829,8830,8831,8833],BRD:[10023,114,116,117,118,13007,14479,16494,16495,16496,17678,17679,17680,17681,17682,17745,17747,3558,3559,3560,3561,3562,4294,50168,50169,50282,50283,50284,50285,50286,50287,7404,7405,7406,7407,7408,7409,8836,8837,8838,8839,8841,8842,8843,8844,9625,106],MCH:[16497,16498,16499,16500,16501,16502,16503,16504,16766,16889,17206,17209,17749,17750,17751,17752,17753,17754,2864,2866,2868,2870,2872,2873,2874,2876,2878,2890,4276,4675,4676,50117,50119,50288,50289,50290,50291,50292,50293,50294,7410,7411,7412,7413,7414,7415,7416,7418,8848,8849,8850,8851,8853,8855],DNC:[17756,17757,17758,17759,17760,17761,17762,17763,17764,17765,17766,17767,17768,17769,17770,17771,17772,17773,17824,17825,17826,17827,17828,17829,18076,15989,15990,15993,15997,15999,16e3,16001,16002,16003,16191,16192,15991,15994,16007,50252,15995,15992,15996,16008,16010,50251,16015,16012,16006,18073,50253,16011,16009,50254,15998,16004,16193,16194,16195,16196,16013,16005,50255,50256,16014],BLM:[14477,153,154,158,159,162,16505,16506,16507,17683,17684,17685,17686,17687,17774,17775,3573,3574,3575,3576,3577,4298,50171,50172,50173,50174,50295,50296,50297,50321,50322,7419,7420,7421,7422,8858,8859,8860,8861,8862,8863,8864,8865,8866,8867,8869,9637,149,155,141,152],SMN:[16510,16511,16513,16514,16515,16516,16517,16518,16519,16522,16523,16549,16795,16796,16797,16798,16799,16800,16801,16802,16803,17777,17778,17779,17780,17781,17782,17783,17784,17785,180,184,3578,3579,3580,3581,3582,4299,50176,50177,50178,50213,50217,50298,50299,50300,50301,50302,7423,7424,7425,7426,7427,7428,7429,7449,7450,787,788,791,792,794,796,797,798,800,801,8872,8873,8874,8877,8878,8879,8880,8881,9014,9432],RDM:[10025,16524,16525,16526,16527,16528,16529,16530,17786,17787,17788,50195,50200,50201,50216,50303,50304,50305,50306,7503,7504,7505,7506,7507,7509,7510,7511,7512,7513,7514,7515,7516,7517,7518,7519,7520,7521,7523,7524,7525,7526,7527,7528,7529,7530,8882,8883,8884,8885,8887,8888,8889,8890,8891,8892,9433,9434],BLU:[11715,11383,11384,11385,11386,11387,11388,11389,11390,11391,11392,11393,11394,11395,11396,11397,11398,11399,11400,11401,11402,11403,11404,11405,11406,11407,11408,11409,11410,11411,11412,11413,11414,11415,11416,11417,11418,11419,11420,11421,11422,11423,11424,11425,11426,11427,11428,11429,11430,11431,50219,50220,50221,50222,50223,50224]};class P{constructor(t,e,a,i,s,n,r,o,l){this.posX=t,this.posY=e,this.posZ=a,this.heading=i,this.targetable=s,this.hp=n,this.maxHp=r,this.mp=o,this.maxMp=l}partialClone(t){var e,a,i,s,n,r,o,l,d;return new P(null!==(e=t.posX)&&void 0!==e?e:this.posX,null!==(a=t.posY)&&void 0!==a?a:this.posY,null!==(i=t.posZ)&&void 0!==i?i:this.posZ,null!==(s=t.heading)&&void 0!==s?s:this.heading,null!==(n=t.targetable)&&void 0!==n?n:this.targetable,null!==(r=t.hp)&&void 0!==r?r:this.hp,null!==(o=t.maxHp)&&void 0!==o?o:this.maxHp,null!==(l=t.mp)&&void 0!==l?l:this.mp,null!==(d=t.maxMp)&&void 0!==d?d:this.maxMp)}toPluginState(){return{PosX:this.posX,PosY:this.posY,PosZ:this.posZ,Heading:this.heading,CurrentHP:this.hp,MaxHP:this.maxHp,CurrentMP:this.mp,MaxMP:this.maxMp}}}const H={cn:["绿宝石兽","黄宝石兽","伊弗利特之灵","泰坦之灵","迦楼罗之灵","朝日小仙女","夕月小仙女","车式浮空炮塔","象式浮空炮塔","亚灵神巴哈姆特","亚灵神不死鸟","炽天使","月长宝石兽","英雄的掠影","后式自走人偶","分身"],de:["Smaragd-Karfunkel","Topas-Karfunkel","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Selbstschuss-Gyrocopter TURM","Selbstschuss-Gyrocopter LÄUFER","Demi-Bahamut","Demi-Phönix","Seraph","Mondstein-Karfunkel","Schattenschemen","Automaton DAME","Gedoppeltes Ich"],en:["Emerald Carbuncle","Topaz Carbuncle","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Rook Autoturret","Bishop Autoturret","Demi-Bahamut","Demi-Phoenix","Seraph","Moonstone Carbuncle","Esteem","Automaton Queen","Bunshin"],fr:["Carbuncle émeraude","Carbuncle topaze","Ifrit-Egi","Titan-Egi","Garuda-Egi","Eos","Selene","Auto-tourelle Tour","Auto-tourelle Fou","Demi-Bahamut","Demi-Phénix","Séraphin","Carbuncle hécatolite","Estime","Automate Reine","Ombre"],ja:["カーバンクル・エメラルド","カーバンクル・トパーズ","イフリート・エギ","タイタン・エギ","ガルーダ・エギ","フェアリー・エオス","フェアリー・セレネ","オートタレット・ルーク","オートタレット・ビショップ","デミ・バハムート","デミ・フェニックス","セラフィム","カーバンクル・ムーンストーン","英雄の影身","オートマトン・クイーン","分身"],ko:["카벙클 에메랄드","카벙클 토파즈","이프리트 에기","타이탄 에기","가루다 에기","요정 에오스","요정 셀레네","자동포탑 룩","자동포탑 비숍","데미바하무트","데미피닉스","세라핌","카벙클 문스톤","영웅의 환영","자동인형 퀸","분신"]},A=0,R=1;class U{constructor(t,e,a){var i,s,n;this.networkLine=e,this.offset=0,this.invalid=!1,this.index=0,this.decEvent=parseInt(null!==(i=a[A])&&void 0!==i?i:"0"),this.hexEvent=L.zeroPad(this.decEvent.toString(16).toUpperCase()),this.timestamp=new Date(null!==(s=a[R])&&void 0!==s?s:"0").getTime(),this.checksum=null!==(n=a.slice(-1)[0])&&void 0!==n?n:"",t.updateTimestamp(this.timestamp),this.convertedLine=this.prefix()+a.join(":").replace("|",":")}prefix(){return"["+L.timeToTimeString(this.timestamp,!0)+"] "+this.hexEvent+":"}static isDamageHallowed(t){return(parseInt(t,16)&parseInt("1000",16))>0}static isDamageBig(t){return(parseInt(t,16)&parseInt("4000",16))>0}static calculateDamage(t){if(U.isDamageHallowed(t))return 0;const e=[(t=L.zeroPad(t,8)).substr(0,2),t.substr(2,2),t.substr(4,2),t.substr(6,2)];return U.isDamageBig(t)?parseInt(e[3]+e[0]+(parseInt(e[1],16)-parseInt(e[3],16)).toString(16),16):parseInt(e.slice(0,2).reverse().join(""),16)}}const D=t=>"isSource"in t,B=t=>"isTarget"in t;class z{constructor(t,e){this.combatants={},this.partyMembers=[],this.enemies=[],this.others=[],this.pets=[],this.initialStates={},this.language=e,this.firstTimestamp=Number.MAX_SAFE_INTEGER,this.lastTimestamp=0,this.initialize(t),this.initialStates={}}initialize(t){var e,a,i,s,n,r,o;for(const e of t)this.firstTimestamp=Math.min(this.firstTimestamp,e.timestamp),this.lastTimestamp=Math.max(this.lastTimestamp,e.timestamp),D(e)&&this.addCombatantFromLine(e),B(e)&&this.addCombatantFromTargetLine(e);for(const t in this.initialStates){const s=null!==(e=this.initialStates[t])&&void 0!==e?e:{};null===(a=this.combatants[t])||void 0===a||a.pushState(this.firstTimestamp,new P(Number(s.posX),Number(s.posY),Number(s.posZ),Number(s.heading),null!==(i=s.targetable)&&void 0!==i&&i,Number(s.hp),Number(s.maxHp),Number(s.mp),Number(s.maxMp)))}const l={};for(const e of t){if(D(e)){const t=this.extractStateFromLine(e);t&&(l[e.id]=null!==(s=l[e.id])&&void 0!==s?s:0,++l[e.id],null===(n=this.combatants[e.id])||void 0===n||n.pushPartialState(e.timestamp,t))}if(B(e)){const t=this.extractStateFromTargetLine(e);t&&(l[e.targetId]=null!==(r=l[e.targetId])&&void 0!==r?r:0,++l[e.targetId],null===(o=this.combatants[e.targetId])||void 0===o||o.pushPartialState(e.timestamp,t))}}const d=H[this.language];this.others=this.others.filter((t=>{var e,a,i,s,n;return void 0!==(null===(e=this.combatants[t])||void 0===e?void 0:e.job)&&"NONE"!==(null===(a=this.combatants[t])||void 0===a?void 0:a.job)&&t.startsWith("1")?(this.partyMembers.push(t),!1):d.includes(null!==(s=null===(i=this.combatants[t])||void 0===i?void 0:i.name)&&void 0!==s?s:"")?(this.pets.push(t),!1):!((null!==(n=l[t])&&void 0!==n?n:0)>0)||(this.enemies.push(t),!1)})),this.mainCombatantID=this.enemies.sort(((t,e)=>{var a,i;return(null!==(a=l[e])&&void 0!==a?a:0)-(null!==(i=l[t])&&void 0!==i?i:0)}))[0]}addCombatantFromLine(t){var e,a,i,s,n,r,o,l,d,p,u,m,c,h,g;const v=this.initCombatant(t.id,t.name),f=null!==(e=this.initialStates[t.id])&&void 0!==e?e:{},y=null!==(a=this.extractStateFromLine(t))&&void 0!==a?a:{};f.posX=null!==(i=f.posX)&&void 0!==i?i:y.posX,f.posY=null!==(s=f.posY)&&void 0!==s?s:y.posY,f.posZ=null!==(n=f.posZ)&&void 0!==n?n:y.posZ,f.heading=null!==(r=f.heading)&&void 0!==r?r:y.heading,f.targetable=null!==(o=f.targetable)&&void 0!==o?o:y.targetable,f.hp=null!==(l=f.hp)&&void 0!==l?l:y.hp,f.maxHp=null!==(d=f.maxHp)&&void 0!==d?d:y.maxHp,f.mp=null!==(p=f.mp)&&void 0!==p?p:y.mp,f.maxMp=null!==(u=f.maxMp)&&void 0!==u?u:y.maxMp,(t=>"isJobLevel"in t)(t)&&(v.job=null!==(c=null===(m=this.combatants[t.id])||void 0===m?void 0:m.job)&&void 0!==c?c:t.job,v.level=null!==(g=null===(h=this.combatants[t.id])||void 0===h?void 0:h.level)&&void 0!==g?g:t.level),(t=>"isAbility"in t)(t)&&(v.job||t.id.startsWith("4")||void 0===t.abilityId||(v.job=j.getJob(t.abilityId))),v.job&&(v.job=v.job.toUpperCase())}addCombatantFromTargetLine(t){var e,a,i,s,n,r,o,l,d,p;this.initCombatant(t.targetId,t.targetName);const u=null!==(e=this.initialStates[t.targetId])&&void 0!==e?e:{},m=null!==(a=this.extractStateFromTargetLine(t))&&void 0!==a?a:{};u.posX=null!==(i=u.posX)&&void 0!==i?i:m.posX,u.posY=null!==(s=u.posY)&&void 0!==s?s:m.posY,u.posZ=null!==(n=u.posZ)&&void 0!==n?n:m.posZ,u.heading=null!==(r=u.heading)&&void 0!==r?r:m.heading,u.hp=null!==(o=u.hp)&&void 0!==o?o:m.hp,u.maxHp=null!==(l=u.maxHp)&&void 0!==l?l:m.maxHp,u.mp=null!==(d=u.mp)&&void 0!==d?d:m.mp,u.maxMp=null!==(p=u.maxMp)&&void 0!==p?p:m.maxMp}extractStateFromLine(t){const e={};return void 0!==t.x&&(e.posX=t.x),void 0!==t.y&&(e.posY=t.y),void 0!==t.z&&(e.posZ=t.z),void 0!==t.heading&&(e.heading=t.heading),void 0!==t.targetable&&(e.targetable=t.targetable),void 0!==t.hp&&(e.hp=t.hp),void 0!==t.maxHp&&(e.maxHp=t.maxHp),void 0!==t.mp&&(e.mp=t.mp),void 0!==t.maxMp&&(e.maxMp=t.maxMp),e}extractStateFromTargetLine(t){const e={};return void 0!==t.targetX&&(e.posX=t.targetX),void 0!==t.targetY&&(e.posY=t.targetY),void 0!==t.targetZ&&(e.posZ=t.targetZ),void 0!==t.targetHeading&&(e.heading=t.targetHeading),void 0!==t.targetHp&&(e.hp=t.targetHp),void 0!==t.targetMaxHp&&(e.maxHp=t.targetMaxHp),void 0!==t.targetMp&&(e.mp=t.targetMp),void 0!==t.targetMaxMp&&(e.maxMp=t.targetMaxMp),e}initCombatant(t,e){let a=this.combatants[t];return void 0===a?(a=this.combatants[t]=new k(t,e),this.others.push(t),this.initialStates[t]={targetable:!0}):""===a.name&&a.setName(e),a}getMainCombatantName(){var t,e;return this.mainCombatantID&&null!==(e=null===(t=this.combatants[this.mainCombatantID])||void 0===t?void 0:t.name)&&void 0!==e?e:"Unknown"}}class O{constructor(){this.listeners={}}on(t,e,a){var i,s,n;const r=t.split(" "),o=[];a=null!=a?a:"undefined"==typeof window?{}:window;for(const t of r){const r=null!==(i=(n=this.listeners)[t])&&void 0!==i?i:n[t]=[];void 0!==e&&r.push({event:t,scope:a,callback:e}),o.push(...null!==(s=this.listeners[t])&&void 0!==s?s:[])}return o}async dispatch(t,...e){var a;if(void 0!==this.listeners[t])for(const i of null!==(a=this.listeners[t])&&void 0!==a?a:[]){const t=i.callback.apply(i.scope,e);await Promise.resolve(t)}}}const Z=2,G=3;class $ extends U{constructor(t,e,a){var i,s;super(t,e,a),this.zoneId=null!==(i=a[Z])&&void 0!==i?i:"",this.zoneName=null!==(s=a[G])&&void 0!==s?s:"",this.zoneNameProperCase=L.properCase(this.zoneName),this.convertedLine=this.prefix()+"Changed Zone to "+this.zoneName+".",this.properCaseConvertedLine=this.prefix()+"Changed Zone to "+this.zoneNameProperCase+"."}}class X extends ${}class Y extends O{constructor(){super(...arguments),this.currentFight=[],this.currentZoneName="Unknown",this.currentZoneId="-1"}parseLogs(t){for(const e of t){this.currentFight.push(e),e.offset=e.timestamp-this.currentFightStart;L.matchEnd(e.networkLine)?this.endFight():e instanceof $&&(this.currentZoneId=e.zoneId,this.currentZoneName=e.zoneName,this.endFight())}}get currentFightStart(){var t,e;return null!==(e=null===(t=this.currentFight[0])||void 0===t?void 0:t.timestamp)&&void 0!==e?e:0}get currentFightEnd(){var t,e;return null!==(e=null===(t=this.currentFight.slice(-1)[0])||void 0===t?void 0:t.timestamp)&&void 0!==e?e:0}endFight(){if(this.currentFight.length<2)return;const t=new Date(this.currentFightStart).toISOString(),e=new Date(this.currentFightEnd).toISOString();console.debug(`Dispatching new fight\nStart: ${t}\nEnd: ${e}\nZone: ${this.currentZoneName}\nLine Count: ${this.currentFight.length}\n`),this.dispatch("fight",t.substr(0,10),this.currentZoneId,this.currentZoneName,this.currentFight),this.currentFight=[]}}class _{constructor(){this.Combatants={},this.firstTimestamp=Number.MAX_SAFE_INTEGER}updateTimestamp(t){this.firstTimestamp=Math.min(this.firstTimestamp,t)}updateCombatant(t,e){if((t=t.toUpperCase())&&t.length){let a=this.Combatants[t];void 0===a?(a={name:e.name,job:e.job,spawn:e.spawn,despawn:e.despawn},this.Combatants[t]=a):(a.name=e.name||a.name,a.job=e.job||a.job,a.spawn=Math.min(a.spawn,e.spawn),a.despawn=Math.max(a.despawn,e.despawn))}}resolveName(t,e,a=null,i=null){var s,n;let r=e;return null!==a&&"E0000000"===t&&""===r&&(r=a.startsWith("4")?null!=i?i:"":"Unknown"),""===r&&(r=null!==(n=null===(s=this.Combatants[t])||void 0===s?void 0:s.name)&&void 0!==n?n:""),r}}const J=2,W=3;class V extends U{constructor(t,e,a){var i,s;super(t,e,a),this.type=null!==(i=a[J])&&void 0!==i?i:"",this.speaker=null!==(s=a[W])&&void 0!==s?s:"",this.message=a.slice(4,-1).join("|"),this.message.split("").length>1&&(this.invalid=!0),this.convertedLine=this.prefix()+this.type+":"+(""!==this.speaker?this.speaker+":":"")+this.message.trim(),this.convertedLine=K.replaceChatSymbols(this.convertedLine)}static replaceChatSymbols(t){for(const e of K.chatSymbolReplacements)t=t.replace(e.Search,e.Replace);return t}}V.chatSymbolReplacements=[{Search:/:\uE06F/g,Replace:":⇒",Type:"Symbol"},{Search:/ \uE0BB\uE05C/g,Replace:" ",Type:"Positive Effect"},{Search:/ \uE0BB\uE05B/g,Replace:" ",Type:"Negative Effect"}];class K extends V{}const q=2,Q=3;class tt extends U{constructor(t,e,a){var i,s,n;super(t,e,a),this.id=null!==(s=null===(i=a[q])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[Q])&&void 0!==n?n:"",this.convertedLine=this.prefix()+"Changed primary player to "+this.name+"."}}class et extends tt{}const at={NONE:0,GLA:1,PGL:2,MRD:3,LNC:4,ARC:5,CNJ:6,THM:7,CRP:8,BSM:9,ARM:10,GSM:11,LTW:12,WVR:13,ALC:14,CUL:15,MIN:16,BTN:17,FSH:18,PLD:19,MNK:20,WAR:21,DRG:22,BRD:23,WHM:24,BLM:25,ACN:26,SMN:27,SCH:28,ROG:29,NIN:30,MCH:31,DRK:32,AST:33,SAM:34,RDM:35,BLU:36,GNB:37,DNC:38},it=Object.keys(at),st=["tank","healer","dps","crafter","gatherer","none"],nt=["GLA","PLD","MRD","WAR","DRK","GNB"],rt=["CNJ","WHM","SCH","AST"],ot=["PGL","MNK","LNC","DRG","ROG","NIN","SAM"],lt=["ARC","BRD","DNC","MCH"],dt=["BLU","RDM","BLM","SMN","ACN","THM"],pt=[...ot,...lt,...dt],ut=["CRP","BSM","ARM","GSM","LTW","WVR","ALC","CUL"],mt=["MIN","BTN","FSH"],ct=["BLU",...nt,...ot],ht=["BLU",...nt,...lt],gt=["BLM","BLU",...rt],vt=[...ot],ft=[...dt],yt=["BLU","BRD",...rt],bt=(()=>{const t=(t,e,a)=>{e.forEach((e=>t.set(e,a)))},e=new Map([["NONE","none"]]);return t(e,nt,"tank"),t(e,rt,"healer"),t(e,pt,"dps"),t(e,ut,"crafter"),t(e,mt,"gatherer"),e})(),Ct={jobEnumToJob:t=>{const e=it.find((e=>at[e]===t));return null!=e?e:"NONE"},jobToJobEnum:t=>at[t],jobToRole:t=>{const e=bt.get(t);return null!=e?e:"none"},getAllRoles:()=>st,isTankJob:t=>nt.includes(t),isHealerJob:t=>rt.includes(t),isMeleeDpsJob:t=>ot.includes(t),isRangedDpsJob:t=>lt.includes(t),isCasterDpsJob:t=>dt.includes(t),isDpsJob:t=>pt.includes(t),isCraftingJob:t=>ut.includes(t),isGatheringJob:t=>mt.includes(t),isCombatJob:t=>!ut.includes(t)&&!mt.includes(t),canStun:t=>ct.includes(t),canSilence:t=>ht.includes(t),canSleep:t=>gt.includes(t),canCleanse:t=>yt.includes(t),canFeint:t=>vt.includes(t),canAddle:t=>ft.includes(t)},xt=2,It=3,St=4,Nt=5,wt=6,Ft=7,Mt=8,Et=9,Lt=10,Tt=11,kt=14,jt=13,Pt=14,Ht=15,At=16,Rt=17,Ut=18,Dt=19,Bt=20;class zt extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m,c,h,g,v,f,y,b,C,x,I,S,N;super(t,e,a),this.isSource=!0,this.isJobLevel=!0,this.id=null!==(s=null===(i=a[xt])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[It])&&void 0!==n?n:"",this.jobIdHex=null!==(o=null===(r=a[St])||void 0===r?void 0:r.toUpperCase())&&void 0!==o?o:"",this.jobId=parseInt(this.jobIdHex,16),this.job=Ct.jobEnumToJob(this.jobId),this.levelString=null!==(l=a[Nt])&&void 0!==l?l:"",this.level=parseFloat(this.levelString),this.ownerId=null!==(p=null===(d=a[wt])||void 0===d?void 0:d.toUpperCase())&&void 0!==p?p:"",this.worldId=null!==(u=a[Ft])&&void 0!==u?u:"",this.worldName=null!==(m=a[Mt])&&void 0!==m?m:"",this.npcNameId=null!==(c=a[Et])&&void 0!==c?c:"",this.npcBaseId=null!==(h=a[Lt])&&void 0!==h?h:"",this.hp=parseFloat(null!==(g=a[Tt])&&void 0!==g?g:""),this.maxHpString=null!==(v=a[kt])&&void 0!==v?v:"",this.maxHp=parseFloat(this.maxHpString),this.mp=parseFloat(null!==(f=a[jt])&&void 0!==f?f:""),this.maxMpString=null!==(y=a[Pt])&&void 0!==y?y:"",this.maxMp=parseFloat(this.maxMpString),this.tp=parseFloat(null!==(b=a[Ht])&&void 0!==b?b:""),this.maxTp=parseFloat(null!==(C=a[At])&&void 0!==C?C:""),this.xString=null!==(x=a[Rt])&&void 0!==x?x:"",this.x=parseFloat(this.xString),this.yString=null!==(I=a[Ut])&&void 0!==I?I:"",this.y=parseFloat(this.yString),this.zString=null!==(S=a[Dt])&&void 0!==S?S:"",this.z=parseFloat(this.zString),this.heading=parseFloat(null!==(N=a[Bt])&&void 0!==N?N:""),t.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp,job:this.jobIdHex});let w=this.name;""!==this.worldName&&(w=w+"("+this.worldName+")"),this.convertedLine=this.prefix()+this.id.toUpperCase()+":Added new combatant "+w+".  Job: "+this.job+" Level: "+this.levelString+" Max HP: "+this.maxHpString+" Max MP: "+this.maxMpString+" Pos: ("+this.xString+","+this.yString+","+this.zString+")";const F=this.npcNameId+L.zeroPad(this.npcBaseId,8+Math.max(0,6-this.npcNameId.length));"00000000000000"!==F&&(this.convertedLine+=" ("+F+")"),this.convertedLine+="."}}class Ot extends zt{}class Zt extends zt{constructor(t,e,a){super(t,e,a),this.convertedLine=this.prefix()+this.id.toUpperCase()+":Removing combatant "+this.name+". Max MP: "+this.maxMpString+". Pos: ("+this.xString+","+this.yString+","+this.zString+")"}}class Gt extends Zt{}const $t=2,Xt=3,Yt=4,_t=5,Jt=6,Wt=7,Vt=8,Kt=9,qt=10,Qt=11,te=12,ee=13,ae=14,ie=15,se=16,ne=18;class re extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m,c,h,g,v,f,y;super(t,e,a),this.class=null!==(i=a[$t])&&void 0!==i?i:"",this.strength=null!==(s=a[Xt])&&void 0!==s?s:"",this.dexterity=null!==(n=a[Yt])&&void 0!==n?n:"",this.vitality=null!==(r=a[_t])&&void 0!==r?r:"",this.intelligence=null!==(o=a[Jt])&&void 0!==o?o:"",this.mind=null!==(l=a[Wt])&&void 0!==l?l:"",this.piety=null!==(d=a[Vt])&&void 0!==d?d:"",this.attackPower=null!==(p=a[Kt])&&void 0!==p?p:"",this.directHit=null!==(u=a[qt])&&void 0!==u?u:"",this.criticalHit=null!==(m=a[Qt])&&void 0!==m?m:"",this.attackMagicPotency=null!==(c=a[te])&&void 0!==c?c:"",this.healMagicPotency=null!==(h=a[ee])&&void 0!==h?h:"",this.determination=null!==(g=a[ae])&&void 0!==g?g:"",this.skillSpeed=null!==(v=a[ie])&&void 0!==v?v:"",this.spellSpeed=null!==(f=a[se])&&void 0!==f?f:"",this.tenacity=null!==(y=a[ne])&&void 0!==y?y:"",this.convertedLine=this.prefix()+"Player Stats: "+a.slice(2,a.length-1).join(":").replace(/\|/g,":")}}class oe extends re{}const le=2,de=3,pe=4,ue=5,me=6,ce=7,he=8;class ge extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m;super(t,e,a),this.isSource=!0,this.isTarget=!0,this.isAbility=!0,this.id=null!==(s=null===(i=a[le])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[de])&&void 0!==n?n:"",this.abilityIdHex=null!==(o=null===(r=a[pe])||void 0===r?void 0:r.toUpperCase())&&void 0!==o?o:"",this.abilityId=parseInt(this.abilityIdHex),this.abilityName=null!==(l=a[ue])&&void 0!==l?l:"",this.targetId=null!==(p=null===(d=a[me])||void 0===d?void 0:d.toUpperCase())&&void 0!==p?p:"",this.targetName=null!==(u=a[ce])&&void 0!==u?u:"",this.duration=null!==(m=a[he])&&void 0!==m?m:"",t.updateCombatant(this.id,{job:void 0,name:this.name,spawn:this.timestamp,despawn:this.timestamp}),t.updateCombatant(this.targetId,{job:void 0,name:this.targetName,spawn:this.timestamp,despawn:this.timestamp});const c=0===this.targetName.length?"Unknown":this.targetName;this.convertedLine=this.prefix()+this.abilityIdHex+":"+this.name+" starts using "+this.abilityName+" on "+c+".",this.properCaseConvertedLine=this.prefix()+this.abilityIdHex+":"+L.properCase(this.name)+" starts using "+this.abilityName+" on "+L.properCase(c)+"."}}class ve extends ge{}const fe=2,ye=3,be=8,Ce=9,xe=4,Ie=5,Se=6,Ne=7,we=24,Fe=25,Me=26,Ee=27,Le=30,Te=31,ke=32,je=33,Pe=34,He=35,Ae=36,Re=37,Ue=40,De=41,Be=42,ze=43;class Oe extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m,c,h,g,v,f,y,b,C,x,I,S,N,w,F,M,E,L;super(t,e,a),this.isSource=!0,this.isTarget=!0,this.isAbility=!0,this.id=null!==(s=null===(i=a[fe])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[ye])&&void 0!==n?n:"",this.flags=null!==(r=a[be])&&void 0!==r?r:"";const T="3F"===this.flags?2:0;this.damage=U.calculateDamage(null!==(o=a[Ce+T])&&void 0!==o?o:""),this.abilityId=parseInt(null!==(d=null===(l=a[xe])||void 0===l?void 0:l.toUpperCase())&&void 0!==d?d:""),this.abilityName=null!==(p=a[Ie])&&void 0!==p?p:"",this.targetId=null!==(m=null===(u=a[Se])||void 0===u?void 0:u.toUpperCase())&&void 0!==m?m:"",this.targetName=null!==(c=a[Ne])&&void 0!==c?c:"",this.targetHp=parseInt(null!==(h=a[we+T])&&void 0!==h?h:""),this.targetMaxHp=parseInt(null!==(g=a[Fe+T])&&void 0!==g?g:""),this.targetMp=parseInt(null!==(v=a[Me+T])&&void 0!==v?v:""),this.targetMaxMp=parseInt(null!==(f=a[Ee+T])&&void 0!==f?f:""),this.targetX=parseFloat(null!==(y=a[Le+T])&&void 0!==y?y:""),this.targetY=parseFloat(null!==(b=a[Te+T])&&void 0!==b?b:""),this.targetZ=parseFloat(null!==(C=a[ke+T])&&void 0!==C?C:""),this.targetHeading=parseFloat(null!==(x=a[je+T])&&void 0!==x?x:""),this.hp=parseInt(null!==(I=a[Pe+T])&&void 0!==I?I:""),this.maxHp=parseInt(null!==(S=a[He+T])&&void 0!==S?S:""),this.mp=parseInt(null!==(N=a[Ae+T])&&void 0!==N?N:""),this.maxMp=parseInt(null!==(w=a[Re+T])&&void 0!==w?w:""),this.x=parseFloat(null!==(F=a[Ue+T])&&void 0!==F?F:""),this.y=parseFloat(null!==(M=a[De+T])&&void 0!==M?M:""),this.z=parseFloat(null!==(E=a[Be+T])&&void 0!==E?E:""),this.heading=parseFloat(null!==(L=a[ze+T])&&void 0!==L?L:""),t.updateCombatant(this.id,{job:void 0,name:this.name,spawn:this.timestamp,despawn:this.timestamp}),t.updateCombatant(this.targetId,{job:void 0,name:this.targetName,spawn:this.timestamp,despawn:this.timestamp})}}class Ze extends Oe{}class Ge extends Oe{constructor(t,e,a){super(t,e,a)}}class $e extends Ge{}const Xe=2,Ye=3,_e=4,Je=5,We=6;class Ve extends U{constructor(t,e,a){var i,s,n,r,o,l,d;super(t,e,a),this.isSource=!0,this.isAbility=!0,this.id=null!==(s=null===(i=a[Xe])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[Ye])&&void 0!==n?n:"",this.abilityId=parseInt(null!==(o=null===(r=a[_e])||void 0===r?void 0:r.toUpperCase())&&void 0!==o?o:""),this.abilityName=null!==(l=a[Je])&&void 0!==l?l:"",this.reason=null!==(d=a[We])&&void 0!==d?d:""}}class Ke extends Ve{}const qe=2,Qe=3,ta=4,ea=5,aa=6,ia=7,sa=8,na=9,ra=10,oa=11,la=12,da=13,pa=14,ua=15,ma=16;class ca extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m,c,h,g,v,f,y,b,C;super(t,e,a),this.isSource=!0,this.id=null!==(s=null===(i=a[qe])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[Qe])&&void 0!==n?n:"",this.type=null!==(r=a[ta])&&void 0!==r?r:"",this.effectId=null!==(l=null===(o=a[ea])||void 0===o?void 0:o.toUpperCase())&&void 0!==l?l:"",this.damage=parseInt(null!==(d=a[aa])&&void 0!==d?d:"",16),this.hp=parseInt(null!==(p=a[ia])&&void 0!==p?p:""),this.maxHp=parseInt(null!==(u=a[sa])&&void 0!==u?u:""),this.mp=parseInt(null!==(m=a[na])&&void 0!==m?m:""),this.maxMp=parseInt(null!==(c=a[ra])&&void 0!==c?c:""),this.tp=parseInt(null!==(h=a[oa])&&void 0!==h?h:""),this.maxTp=parseInt(null!==(g=a[la])&&void 0!==g?g:""),this.x=parseFloat(null!==(v=a[da])&&void 0!==v?v:""),this.y=parseFloat(null!==(f=a[pa])&&void 0!==f?f:""),this.z=parseFloat(null!==(y=a[ua])&&void 0!==y?y:""),this.heading=parseFloat(null!==(b=a[ma])&&void 0!==b?b:""),t.updateCombatant(this.id,{job:void 0,name:this.name,spawn:this.timestamp,despawn:this.timestamp});let x="";const I=t.resolveName(this.id,this.name);this.effectId in ca.showEffectNamesFor&&(x=null!==(C=ca.showEffectNamesFor[this.effectId])&&void 0!==C?C:"");let S="";x&&(S=x+" "),this.convertedLine=this.prefix()+S+this.type+" Tick on "+I+" for "+this.damage.toString()+" damage.",this.properCaseConvertedLine=this.prefix()+S+this.type+" Tick on "+L.properCase(I)+" for "+this.damage.toString()+" damage."}}ca.showEffectNamesFor={"4C4":"Excognition","35D":"Wildfire","1F5":"Doton","2ED":"Salted Earth","4B5":"Flamethrower","2E3":"Asylum",777:"Asylum",798:"Sacred Soil","4C7":"Fey Union",742:"Nascent Glint"};class ha extends ca{}const ga=2,va=3,fa=4,ya=5;class ba extends U{constructor(t,e,a){var i,s,n,r,o,l;let d,p;super(t,e,a),this.id=null!==(s=null===(i=a[ga])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[va])&&void 0!==n?n:"",this.targetId=null!==(o=null===(r=a[fa])||void 0===r?void 0:r.toUpperCase())&&void 0!==o?o:"",this.targetName=null!==(l=a[ya])&&void 0!==l?l:"",t.updateCombatant(this.id,{job:void 0,name:this.name,spawn:this.timestamp,despawn:this.timestamp}),t.updateCombatant(this.targetId,{job:void 0,name:this.targetName,spawn:this.timestamp,despawn:this.timestamp}),"00"!==this.id&&(d=t.resolveName(this.id,this.name)),"00"!==this.targetId&&(p=t.resolveName(this.targetId,this.targetName));const u=null!=d?d:this.name,m=null!=p?p:this.targetName;this.convertedLine=this.prefix()+u+" was defeated by "+m+".",this.properCaseConvertedLine=this.prefix()+L.properCase(u)+" was defeated by "+L.properCase(m)+"."}}class Ca extends ba{}const xa=2,Ia=3,Sa=4,Na=5,wa=6,Fa=7,Ma=8,Ea=9,La=10,Ta=11;class ka extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m,c,h,g;super(t,e,a),this.isAbility=!0,this.abilityId=parseInt(null!==(s=null===(i=a[xa])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:""),this.abilityName=null!==(n=a[Ia])&&void 0!==n?n:"",this.durationString=null!==(r=a[Sa])&&void 0!==r?r:"",this.durationFloat=parseFloat(this.durationString),this.id=null!==(l=null===(o=a[Na])||void 0===o?void 0:o.toUpperCase())&&void 0!==l?l:"",this.name=null!==(d=a[wa])&&void 0!==d?d:"",this.targetId=null!==(u=null===(p=a[Fa])||void 0===p?void 0:p.toUpperCase())&&void 0!==u?u:"",this.targetName=null!==(m=a[Ma])&&void 0!==m?m:"",this.stacks=parseInt(null!==(c=a[Ea])&&void 0!==c?c:"0"),this.targetHp=parseInt(null!==(h=a[La])&&void 0!==h?h:""),this.hp=parseInt(null!==(g=a[Ta])&&void 0!==g?g:""),t.updateCombatant(this.id,{name:this.name,spawn:this.timestamp,despawn:this.timestamp,job:void 0}),t.updateCombatant(this.targetId,{name:this.targetName,spawn:this.timestamp,despawn:this.timestamp,job:void 0}),this.resolvedName=t.resolveName(this.id,this.name),this.resolvedTargetName=t.resolveName(this.targetId,this.targetName),this.fallbackResolvedTargetName=t.resolveName(this.id,this.name,this.targetId,this.targetName);let v="";this.stacks>0&&this.stacks<20&&ka.showStackCountFor.includes(this.abilityId)&&(v=" ("+this.stacks.toString()+")"),this.convertedLine=this.prefix()+this.targetId+":"+this.targetName+" gains the effect of "+this.abilityName+" from "+this.fallbackResolvedTargetName+" for "+this.durationString+" Seconds."+v,this.properCaseConvertedLine=this.prefix()+this.targetId+":"+L.properCase(this.targetName)+" gains the effect of "+this.abilityName+" from "+L.properCase(this.fallbackResolvedTargetName)+" for "+this.durationString+" Seconds."+v}}ka.showStackCountFor=[304,406,350,714,505,1239,1297];class ja extends ka{}const Pa=2,Ha=3,Aa=6;class Ra extends U{constructor(t,e,a){var i,s,n,r;super(t,e,a),this.isSource=!0,this.id=null!==(s=null===(i=a[Pa])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[Ha])&&void 0!==n?n:"",this.headmarkerId=null!==(r=a[Aa])&&void 0!==r?r:""}}class Ua extends Ra{}const Da=2,Ba=3,za=4,Oa=5,Za=6,Ga=7,$a=8;class Xa extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p;super(t,e,a),this.operation=null!==(i=a[Da])&&void 0!==i?i:"",this.waymark=null!==(s=a[Ba])&&void 0!==s?s:"",this.id=null!==(r=null===(n=a[za])||void 0===n?void 0:n.toUpperCase())&&void 0!==r?r:"",this.name=null!==(o=a[Oa])&&void 0!==o?o:"",this.x=null!==(l=a[Za])&&void 0!==l?l:"",this.y=null!==(d=a[Ga])&&void 0!==d?d:"",this.z=null!==(p=a[$a])&&void 0!==p?p:""}}class Ya extends Xa{}const _a=2,Ja=3,Wa=4,Va=5,Ka=6,qa=7;class Qa extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p;super(t,e,a),this.operation=null!==(i=a[_a])&&void 0!==i?i:"",this.waymark=null!==(s=a[Ja])&&void 0!==s?s:"",this.id=null!==(r=null===(n=a[Wa])||void 0===n?void 0:n.toUpperCase())&&void 0!==r?r:"",this.name=null!==(o=a[Va])&&void 0!==o?o:"",this.targetId=null!==(d=null===(l=a[Ka])||void 0===l?void 0:l.toUpperCase())&&void 0!==d?d:"",this.targetName=null!==(p=a[qa])&&void 0!==p?p:""}}class ti extends Qa{}class ei extends ka{constructor(t,e,a){super(t,e,a);let i="";this.stacks>0&&this.stacks<20&&ka.showStackCountFor.includes(this.abilityId)&&(i=" ("+this.stacks.toString()+")"),this.convertedLine=this.prefix()+this.targetId+":"+this.targetName+" loses the effect of "+this.abilityName+" from "+this.fallbackResolvedTargetName+" for "+this.durationString+" Seconds."+i,this.properCaseConvertedLine=this.prefix()+this.targetId+":"+L.properCase(this.targetName)+" loses the effect of "+this.abilityName+" from "+L.properCase(this.fallbackResolvedTargetName)+" for "+this.durationString+" Seconds."+i}}class ai extends ei{}const ii=t=>[t.substr(6,2),t.substr(4,2),t.substr(2,2),t.substr(0,2)],si=2,ni=3,ri=4,oi=5,li=6;class di extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u;super(t,e,a),this.id=null!==(s=null===(i=a[si])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.dataBytes1=L.zeroPad(null!==(n=a[ni])&&void 0!==n?n:""),this.dataBytes2=L.zeroPad(null!==(r=a[ri])&&void 0!==r?r:""),this.dataBytes3=L.zeroPad(null!==(o=a[oi])&&void 0!==o?o:""),this.dataBytes4=L.zeroPad(null!==(l=a[li])&&void 0!==l?l:""),this.jobGaugeBytes=[...ii(this.dataBytes1),...ii(this.dataBytes2),...ii(this.dataBytes3),...ii(this.dataBytes4)],this.name=(null===(d=t.Combatants[this.id])||void 0===d?void 0:d.name)||"",t.updateCombatant(this.id,{name:null===(p=t.Combatants[this.id])||void 0===p?void 0:p.name,spawn:this.timestamp,despawn:this.timestamp,job:null===(u=this.jobGaugeBytes[0])||void 0===u?void 0:u.toUpperCase()}),this.convertedLine=this.prefix()+this.id+":"+this.name+":"+this.dataBytes1+":"+this.dataBytes2+":"+this.dataBytes3+":"+this.dataBytes4,this.properCaseConvertedLine=this.prefix()+this.id+":"+L.properCase(this.name)+":"+this.dataBytes1+":"+this.dataBytes2+":"+this.dataBytes3+":"+this.dataBytes4}}class pi extends di{}const ui=2,mi=3,ci=4,hi=5,gi=6;class vi extends U{constructor(t,e,a){var i,s,n,r,o,l,d;super(t,e,a),this.isSource=!0,this.id=null!==(s=null===(i=a[ui])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[mi])&&void 0!==n?n:"",this.targetId=null!==(o=null===(r=a[ci])||void 0===r?void 0:r.toUpperCase())&&void 0!==o?o:"",this.targetName=null!==(l=a[hi])&&void 0!==l?l:"",this.targetable=!!parseInt(null!==(d=a[gi])&&void 0!==d?d:"",16)}}class fi extends vi{}const yi=2,bi=3,Ci=4,xi=5,Ii=8;class Si extends U{constructor(t,e,a){var i,s,n,r,o,l,d;super(t,e,a),this.id=null!==(s=null===(i=a[yi])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[bi])&&void 0!==n?n:"",this.targetId=null!==(o=null===(r=a[Ci])||void 0===r?void 0:r.toUpperCase())&&void 0!==o?o:"",this.targetName=null!==(l=a[xi])&&void 0!==l?l:"",this.tetherId=null!==(d=a[Ii])&&void 0!==d?d:""}}class Ni extends Si{}const wi=2,Fi=3;class Mi extends U{constructor(t,e,a){var i,s;super(t,e,a),this.valueHex=null!==(i=a[wi])&&void 0!==i?i:"",this.valueDec=parseInt(this.valueHex,16),this.bars=null!==(s=a[Fi])&&void 0!==s?s:"",this.convertedLine=this.prefix()+"Limit Break: "+this.valueHex}}class Ei extends Mi{}const Li=2,Ti=3,ki=4,ji=5,Pi=6,Hi=7,Ai=8,Ri=9,Ui=10,Di=11,Bi=12,zi=13,Oi=14;class Zi extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m,c,h,g,v;super(t,e,a),this.isSource=!0,this.id=null!==(s=null===(i=a[Li])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[Ti])&&void 0!==n?n:"",this.sequenceId=null!==(r=a[ki])&&void 0!==r?r:"",this.hp=parseInt(null!==(o=a[ji])&&void 0!==o?o:""),this.maxHp=parseInt(null!==(l=a[Pi])&&void 0!==l?l:""),this.mp=parseInt(null!==(d=a[Hi])&&void 0!==d?d:""),this.maxMp=parseInt(null!==(p=a[Ai])&&void 0!==p?p:""),this.tp=parseInt(null!==(u=a[Ri])&&void 0!==u?u:""),this.maxTp=parseInt(null!==(m=a[Ui])&&void 0!==m?m:""),this.x=parseFloat(null!==(c=a[Di])&&void 0!==c?c:""),this.y=parseFloat(null!==(h=a[Bi])&&void 0!==h?h:""),this.z=parseFloat(null!==(g=a[zi])&&void 0!==g?g:""),this.heading=parseFloat(null!==(v=a[Oi])&&void 0!==v?v:"")}}class Gi extends Zi{}const $i=2,Xi=3,Yi=4,_i=5,Ji=6,Wi=7,Vi=8,Ki=9,qi=10,Qi=11,ts=12,es=13,as=14;class is extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m,c,h,g,v;super(t,e,a),this.isSource=!0,this.isJobLevel=!0,this.id=null!==(s=null===(i=a[$i])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[Xi])&&void 0!==n?n:"",this.jobLevelData=null!==(r=a[Yi])&&void 0!==r?r:"",this.hp=parseInt(null!==(o=a[_i])&&void 0!==o?o:""),this.maxHp=parseInt(null!==(l=a[Ji])&&void 0!==l?l:""),this.mp=parseInt(null!==(d=a[Wi])&&void 0!==d?d:""),this.maxMp=parseInt(null!==(p=a[Vi])&&void 0!==p?p:""),this.tp=parseInt(null!==(u=a[Ki])&&void 0!==u?u:""),this.maxTp=parseInt(null!==(m=a[qi])&&void 0!==m?m:""),this.x=parseFloat(null!==(c=a[Qi])&&void 0!==c?c:""),this.y=parseFloat(null!==(h=a[ts])&&void 0!==h?h:""),this.z=parseFloat(null!==(g=a[es])&&void 0!==g?g:""),this.heading=parseFloat(null!==(v=a[as])&&void 0!==v?v:"");const f=L.zeroPad(this.jobLevelData,8);this.jobIdHex=f.substr(6,2).toUpperCase(),this.jobId=parseInt(this.jobIdHex,16),this.job=Ct.jobEnumToJob(this.jobId),this.level=parseInt(f.substr(4,2),16)}}class ss extends is{}const ns=2,rs=3,os=4,ls=5,ds=6,ps=7,us=8,ms=9,cs=10,hs=11,gs=12,vs=13;class fs extends U{constructor(t,e,a){var i,s,n,r,o,l,d,p,u,m,c,h,g;super(t,e,a),this.isSource=!0,this.id=null!==(s=null===(i=a[ns])||void 0===i?void 0:i.toUpperCase())&&void 0!==s?s:"",this.name=null!==(n=a[rs])&&void 0!==n?n:"",this.hp=parseInt(null!==(r=a[os])&&void 0!==r?r:""),this.maxHp=parseInt(null!==(o=a[ls])&&void 0!==o?o:""),this.mp=parseInt(null!==(l=a[ds])&&void 0!==l?l:""),this.maxMp=parseInt(null!==(d=a[ps])&&void 0!==d?d:""),this.tp=parseInt(null!==(p=a[us])&&void 0!==p?p:""),this.maxTp=parseInt(null!==(u=a[ms])&&void 0!==u?u:""),this.x=parseFloat(null!==(m=a[cs])&&void 0!==m?m:""),this.y=parseFloat(null!==(c=a[hs])&&void 0!==c?c:""),this.z=parseFloat(null!==(h=a[gs])&&void 0!==h?h:""),this.heading=parseFloat(null!==(g=a[vs])&&void 0!==g?g:"")}}class ys extends fs{}const bs=t=>!!t;class Cs extends O{convertFile(t){const e=new _;return this.convertLines(t.split(Cs.lineSplitRegex).filter((t=>""!==t)),e)}convertLines(t,e){let a=t.map((t=>class{static parse(t,e){let a;const i=e.split("|"),s=i[0];if(s&&"252"!==s){switch("LineEvent"+s){case"LineEvent00":a=new K(t,e,i);break;case"LineEvent01":a=new X(t,e,i);break;case"LineEvent02":a=new et(t,e,i);break;case"LineEvent03":a=new Ot(t,e,i);break;case"LineEvent04":a=new Gt(t,e,i);break;case"LineEvent12":a=new oe(t,e,i);break;case"LineEvent20":a=new ve(t,e,i);break;case"LineEvent21":a=new Ze(t,e,i);break;case"LineEvent22":a=new $e(t,e,i);break;case"LineEvent23":a=new Ke(t,e,i);break;case"LineEvent24":a=new ha(t,e,i);break;case"LineEvent25":a=new Ca(t,e,i);break;case"LineEvent26":a=new ja(t,e,i);break;case"LineEvent27":a=new Ua(t,e,i);break;case"LineEvent28":a=new Ya(t,e,i);break;case"LineEvent29":a=new ti(t,e,i);break;case"LineEvent30":a=new ai(t,e,i);break;case"LineEvent31":a=new pi(t,e,i);break;case"LineEvent34":a=new fi(t,e,i);break;case"LineEvent35":a=new Ni(t,e,i);break;case"LineEvent36":a=new Ei(t,e,i);break;case"LineEvent37":a=new Gi(t,e,i);break;case"LineEvent38":a=new ss(t,e,i);break;case"LineEvent39":a=new ys(t,e,i);break;default:a=new U(t,e,i)}if(!(a&&a.timestamp<946684800||a&&a.invalid))return a}}}.parse(e,t))).filter(bs);return a=a.map(((t,e)=>(t.index=e,t))),a.sort(((t,e)=>`${t.timestamp}_${t.index}`.localeCompare(`${e.timestamp}_${e.index}`)))}}Cs.lineSplitRegex=/\r?\n/gm;const xs=(t,e)=>{if(e)return H[e].includes(t);for(const e in H)if(H[e].includes(t))return!0;return!1};class Is{constructor(t,e,a,i){this.version=Is.encounterVersion,this.id=null,this.encounterZoneId=e,this.encounterZoneName=a,this.encounterDay=t,this.logLines=i}initialize(){this.initialOffset=Number.MAX_SAFE_INTEGER,this.endStatus="Unknown",this.startStatus=new Set,this.engageAt=Number.MAX_SAFE_INTEGER,this.firstPlayerAbility=Number.MAX_SAFE_INTEGER,this.firstEnemyAbility=Number.MAX_SAFE_INTEGER,this.firstLineIndex=0;for(let t=0;t<this.logLines.length;++t){const e=this.logLines[t];let a=L.matchStart(e.networkLine);if(a){this.firstLineIndex=t,this.startStatus.add(a.groups.StartType);const i=parseInt(a.groups.StartIn);i>=0&&(this.engageAt=Math.min(e.timestamp+i,this.engageAt))}else a=L.matchEnd(e.networkLine),a?this.endStatus=a.groups.EndType:e.id&&e.targetId&&(e.id.startsWith("1")||e.id.startsWith("4")&&xs(e.name,this.language)?e.targetId.startsWith("4")&&!xs(e.targetName,this.language)&&(this.firstPlayerAbility=Math.min(this.firstPlayerAbility,e.timestamp)):e.id.startsWith("4")&&!xs(e.name,this.language)&&(e.targetId.startsWith("1")||xs(e.targetName,this.language))&&(this.firstEnemyAbility=Math.min(this.firstEnemyAbility,e.timestamp)));a&&a.groups&&a.groups.language&&(this.language=a.groups.language||this.language)}this.language=this.language||"en",this.firstPlayerAbility===Number.MAX_SAFE_INTEGER&&(this.firstPlayerAbility=null),this.firstEnemyAbility===Number.MAX_SAFE_INTEGER&&(this.firstEnemyAbility=null),this.engageAt===Number.MAX_SAFE_INTEGER&&(this.engageAt=null),this.combatantTracker=new z(this.logLines,this.language),this.startTimestamp=this.combatantTracker.firstTimestamp,this.endTimestamp=this.combatantTracker.lastTimestamp,this.duration=this.endTimestamp-this.startTimestamp,this.initialOffset===Number.MAX_SAFE_INTEGER&&(null!==this.engageAt?this.initialOffset=this.engageAt-this.startTimestamp:null!==this.firstPlayerAbility?this.initialOffset=this.firstPlayerAbility-this.startTimestamp:null!==this.firstEnemyAbility?this.initialOffset=this.firstEnemyAbility-this.startTimestamp:this.initialOffset=0),this.playbackOffset=this.logLines[this.firstLineIndex].offset,this.startStatus=[...this.startStatus].sort().join(", ")}shouldPersistFight(){return this.firstPlayerAbility>0&&this.firstEnemyAbility>0}upgrade(t){if(Is.encounterVersion<=t)return!1;const e=new _,a=new Cs;return this.logLines=a.convertLines(this.logLines.map((t=>t.networkLine)),e),this.version=Is.encounterVersion,this.initialize(),!0}}Is.encounterVersion=1,onmessage=async t=>{const e=new Cs,a=new Y,i=new _;a.on("fight",(async(t,e,a,i)=>{const s=new Is(t,e,a,i);s.initialize(),s.shouldPersistFight()&&postMessage({type:"encounter",encounter:s,name:s.combatantTracker.getMainCombatantName()})}));const s=new TextDecoder("UTF-8");let n=new Uint8Array(t.data),r=0,o=[],l=0;for(let t=r;r<n.length&&-1!==r;t=r){r=n.indexOf(10,r+1);const d=s.decode(n.slice(t,r)).trim();d.length&&(++l,o.push(d)),o.length>=1e3&&(o=e.convertLines(o,i),a.parseLogs(o),postMessage({type:"progress",lines:l,bytes:r,totalBytes:n.length}),o=[])}o.length>0&&(o=e.convertLines(o,i),a.parseLogs(o),o=[]),postMessage({type:"progress",lines:l,bytes:n.length,totalBytes:n.length}),n=null,a.endFight(),postMessage({type:"done"})}})();